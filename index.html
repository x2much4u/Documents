<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VividAvatarFX ドキュメント</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            word-break: break-word;
        }
        header p {
            font-size: 1em;
            opacity: 0.9;
        }
        .content {
            padding: 20px;
        }
        h2 {
            color: #667eea;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.5em;
        }
        h3 {
            color: #764ba2;
            margin: 25px 0 10px 0;
            font-size: 1.2em;
        }
        h4 {
            color: #667eea;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: bold;
            margin-right: 8px;
            font-size: 0.9em;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
            word-break: break-all;
            font-size: 0.9em;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }
        ul, ol {
            margin: 15px 0 15px 20px;
        }
        li {
            margin: 8px 0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .feature-card h4 {
            margin-top: 0;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .feature-card p {
            font-size: 0.9em;
        }
        footer {
            background: #2d2d2d;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9em;
        }
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .toc ul {
            list-style: none;
            margin-left: 0;
        }
        .toc a {
            color: #667eea;
            text-decoration: none;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            header h1 {
                font-size: 1.5em;
            }
            h2 {
                font-size: 1.3em;
            }
            h3 {
                font-size: 1.1em;
            }
            .content {
                padding: 15px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>VividAvatarFX</h1>
            <p>VRChat想定アバターギミック</p>
        </header>

        <div class="content">
            <h2>クイックスタート</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Prefabの配置</strong>
                <p><code>Assets/x2much4u/VividAvatarFX/Prefab/VividAvatarFX</code> をアバターの直下に配置</p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Effectオブジェクトの選択</strong>
                <p>Prefab内の <code>VividAvatarFX/Effect</code> を選択してInspectorを表示</p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Setup Toolの起動</strong>
                <p>以下のいずれかの方法でSetup Toolを開きます：</p>
                <ul>
                    <li><strong>方法1:</strong> Inspector上部にある緑色の「設定変更後は必ずベイクしてください。」ボタンをクリック</li>
                    <li><strong>方法2:</strong> Unityメニューバーから<br><code>Tools → x2much4u → VividAvatarFX → VAFX Setup Tool</code> を選択</li>
                </ul>
                <p>Setup Toolウィンドウが開きます。</p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>アバターの設定</strong>
                <p>Setup Tool内の「ターゲットアバター」欄にHierarchyから導入したいアバターをドラッグ&ドロップ</p>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>ベイク実行</strong>
                <p>緑色の「マテリアル値を焼き込み & アバターに統合 (Bake & Merge)」ボタンをクリック</p>
            </div>

            <div class="success">
                <strong>セットアップ完了</strong>
                <p>これでVividAvatarFXの導入は完了です。。</p>
            </div>

            <div class="info">
                <strong>なぜベイクが必要なのか？</strong>
                <p>VividAvatarFXは、MA（Modular Avatar）Parametersを使用していません。そのため、<strong>現在のマテリアルに設定されている値を直接アバターのExpressionParametersに焼き込む</strong>必要があります。</p>
                <p>ベイク処理で行われること：</p>
                <ul>
                    <li>マテリアルの全プロパティ値をRadial Puppet用に0-1の範囲に正規化</li>
                    <li>正規化された値をExpressionParametersのDefault値として設定</li>
                    <li>VRCAvatarParameterDriverに初期値を記録</li>
                    <li>アバターのExpressionParametersにVAFXパラメーターをマージ</li>
                </ul>
                <p>この仕組みにより、VRC内で値を変更可能になっています。</p>
            </div>

            <div class="warning">
                <strong>重要</strong>
                <p><strong>VAFXマテリアルの値</strong>を変更したら、必ず再度ベイクしてください。ベイクしないとVRChat内で変更が反映されません。</p>
                <p><strong>※服や髪のマテリアルなど、VAFX以外のマテリアルの値を変更した場合は再度ベイクする必要はありません。</strong></p>
            </div>

            <h2>目次</h2>
            <div class="toc">
                <ul>
                    <li><a href="#overview">概要</a></li>
                    <li><a href="#adjustment">エフェクトの調整方法</a></li>
                    <li><a href="#preset">プリセット機能</a></li>
                    <li><a href="#technical">技術仕様</a></li>
                    <li><a href="#faq">よくある質問</a></li>
                    <li><a href="#license">ライセンス情報</a></li>
                </ul>
            </div>

            <h2 id="overview">概要</h2>
            <p>VividAvatarFXは、VRChatアバターの視界に様々な視覚エフェクトを追加できるシステムです。カラーグレーディング、グリッチエフェクト、レンズ歪み、ビネット、ブルームなど、多彩なエフェクトをリアルタイムで制御できます。</p>

            <h3>主な機能</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>カラーグレーディング</h4>
                    <p>明度、彩度、コントラスト、色相シフト、ガンマ調整</p>
                </div>
                <div class="feature-card">
                    <h4>グリッチエフェクト</h4>
                    <p>ラインシフト、カラー分離、ブロックノイズ</p>
                </div>
                <div class="feature-card">
                    <h4>レンズエフェクト</h4>
                    <p>レンズ歪み、色収差、ビネット</p>
                </div>
                <div class="feature-card">
                    <h4>ポストプロセス</h4>
                    <p>ブルーム、ノイズ、ディザリング、ポスタライズ</p>
                </div>
            </div>

            <h2 id="adjustment">エフェクトの調整方法</h2>

            <h3>マテリアルエディタから調整</h3>
            <p><code>Assets/x2much4u/VividAvatarFX/Material/VividAvatarFX.mat</code> を選択すると、Inspectorにカスタムエディタが表示されます。</p>

            <h3>主要なパラメータ</h3>
            
            <h4>基本設定</h4>
            <ul>
                <li><strong>メインカラー (HSV+Alpha):</strong> エフェクト全体の基本色</li>
                <li><strong>全体の透明度:</strong> エフェクトの不透明度</li>
                <li><strong>表示設定:</strong> VR/デスクトップ/カメラでの表示切り替え</li>
            </ul>

            <h4>カラーグレーディング</h4>
            <ul>
                <li><strong>明るさ/コントラスト/彩度:</strong> 基本的な色調整</li>
                <li><strong>色相シフト:</strong> 色の回転</li>
                <li><strong>ガンマ:</strong> 中間調の調整</li>
                <li><strong>トーンカーブ:</strong> RGB各チャンネルの詳細調整</li>
                <li><strong>Lift/Gamma/Gain:</strong> 映画的な色補正（シャドウ/ミッドトーン/ハイライト）</li>
            </ul>

            <h4>エフェクト</h4>
            <ul>
                <li><strong>ビネット:</strong> 画面端の暗化効果</li>
                <li><strong>シネマティックライン:</strong> 映画的な黒帯</li>
                <li><strong>ネオンエッジ:</strong> エッジ検出による発光</li>
                <li><strong>ノイズ/グレイン:</strong> フィルムグレイン効果</li>
                <li><strong>ブルーム:</strong> 明るい部分の発光</li>
                <li><strong>色収差:</strong> レンズの色ずれ</li>
                <li><strong>レンズ歪み:</strong> 魚眼効果、バレル/ピンクッション歪み</li>
                <li><strong>グリッチ:</strong> デジタルノイズ効果</li>
            </ul>

            <h2 id="preset">プリセット機能</h2>

            <h3>プリセットの登録</h3>
            <p>現在のマテリアル設定をプリセットとして保存できます。</p>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Preset Makerを開く</strong>
                <ul>
                    <li>マテリアルInspectorの「プリセット登録はこちら」ボタン、または</li>
                    <li><code>Tools → x2much4u → VividAvatarFX → VAFX Preset Maker</code></li>
                </ul>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>プリセットスロット選択</strong>
                <p>Preset01〜Preset08のいずれかを選択します。</p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>表示名の入力</strong>
                <p>VRChatメニューに表示される名前を入力します。</p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>ベイク実行</strong>
                <p>緑色の「プリセット [名前] をベイク (Bake Preset)」ボタンをクリックします。</p>
            </div>

            <div class="info">
                <strong>プリセットの保存場所</strong>
                <p>プリセットは <code>Assets/x2much4u/VividAvatarFX/Preset/</code> にJSON形式で保存されます。このフォルダ内にサブフォルダを作成しても認識されます。</p>
            </div>

            <h3>プリセットの読み込み</h3>
            <p>マテリアルInspectorの「プリセット」ドロップダウンから保存済みプリセットを選択し、「適用」ボタンをクリックすると設定が反映されます。</p>

            <div class="warning">
                <strong>注意</strong>
                <p>プリセットを適用しただけではVRChat内では変更されません。適用後、必ずSetup ToolもしくはPreset Makerで保存してください。</p>
            </div>

            <h3>エクスポート機能</h3>
            <p>マテリアルInspectorの「エクスポート」ボタンで、現在の設定をJSON形式で保存できます。</p>
            
            <div class="info">
                <strong>プリセット登録との違い</strong>
                <ul>
                    <li><strong>プリセット登録:</strong> AnimatorControllerに設定を書き込み、VRChatメニューから切り替え可能にする</li>
                    <li><strong>エクスポート:</strong> 設定をJSONファイルとして出力するだけ（共有用）</li>
                </ul>
                <p>他の人に設定を共有したい場合は、エクスポートが便利です。</p>
            </div>

            <h2 id="technical">技術仕様</h2>

            <h3>パラメーターの正規化</h3>
            <p>VRChatのRadial Puppetで使用するため、全てのパラメーターは0〜1の範囲に正規化されます。</p>
            
            <div class="code-block">
                例: ToneCurveRedScale (0-10) → 正規化 (0-1)</br>
                正規化値 = 元の値 / 10.0</br>
                例: LensDistortionBarrel (-1 to 1) → 正規化 (0-1)</br>
                正規化値 = (元の値 + 1.0) / 2.0
            </div>

            <h2 id="faq">よくある質問</h2>

            <h3>Q: デスクトップなのに「その他」でしか表示されない / デスクトップでONにならない</h3>
            <p><strong>A:</strong> VividAvatarFXのデスクトップ判定は非常に厳密な条件で行われます:</p>
            <ul>
                <li>視野角（FOV）が60°付近（±0.01°以内）</li>
                <li>カメラがほぼ水平（わずかな傾きも検出）</li>
            </ul>
            <p>以下の場合、判定が失敗し「その他」として扱われます:</p>
            <ul>
                <li>VRChatやUnityの設定でFOVが少しでも変更されている</li>
                <li>カメラを傾けるギミックや他の視界エフェクトを使用している</li>
                <li>わずかでもカメラが傾いている（数値的にほぼ検出不可能なレベル）</li>
            </ul>
            <p><strong>解決方法:</strong></p>
            <ul>
                <li><strong>推奨：「EnableOther」をONにする</strong>（最も確実で簡単）</li>
                <li>VRChatのカメラ設定をデフォルトに戻す</li>
                <li>カメラを傾けるギミックやエフェクトを無効化する</li>
            </ul>
            <p>デスクトップ判定は非常に厳密なため、FOVを変更している場合は「EnableOther」を使用してください。</p>
            <div class="info">
                <strong>技術的な詳細</strong>
                <p>シェーダー内部では、Y軸のX方向オフセット（カメラの向きの角度）を検出してデスクトップかどうかを判定しています。この判定は±0.0001という極めて小さな許容範囲で行われるため、人間には認識できないレベルのカメラの傾きでも判定に失敗します。</p>
            </div>

            <h3>Q: 「VRCのカメラに表示」のみONにしているのに、画面全体にエフェクトがかかる</h3>
            <p><strong>A:</strong> これはシェーダーの判定の仕組み上、プレイヤー視点のFOVが60°以外の場合に発生する問題です。</p>
            
            <p><strong>発生する条件：</strong></p>
            <ul>
                <li><strong>プレイヤー視点のFOVが60°以外に設定されている</strong></li>
                <li>デスクトップで1920x1080、1280x720、または3840x2160の解像度でプレイ</li>
            </ul>

            <p><strong>なぜ起こるのか：</strong></p>
            <p>FOVが60°の場合とそれ以外で、判定が異なります：</p>
            
            <p><strong>FOVが60°の場合（正常動作）：</strong></p>
            <ol>
                <li>デスクトップ判定が成功 → EnableDesktopの設定に従う</li>
                <li>EnableDesktopがOFFなので → エフェクトは表示されない</li>
            </ol>

            <p><strong>FOVが60°以外の場合（問題発生）：</strong></p>
            <ol>
                <li>デスクトップ判定が失敗（FOVが60°でないため）</li>
                <li>次のカメラ判定（解像度チェック）に進む</li>
                <li>解像度が1920x1080などに該当 → カメラと誤認識</li>
                <li>EnableSSがONなので → <strong>エフェクトが表示される</strong></li>
            </ol>

            <p>つまり、FOVを変更している環境では、プレイヤー視点でプレイ中なのに「カメラで撮影中」と誤認識され、EnableSSがONのためエフェクトが表示されてしまいます。</p>

            <p><strong>解決方法：</strong></p>
            <ul>
                <li><strong>推奨：ウィンドウモードにする</strong>（VRCをアクティブにし、Alt+Enter）</li>
                <li>プレイヤー視点のFOVを60°に戻す</li>
            </ul>

            <div class="warning">
                <strong>なぜ60°なのか？</strong>
                <p>VRCのカメラの視野角は<strong>60°から変更することができません。</strong></p>
                <p>この特性を用いてカメラの判定を拾っているため、60°以外に設定していると意図せぬ挙動になってしまいます。</p>
            </div>

            <h3>Q: エフェクトが表示されない</h3>
            <p><strong>A:</strong> 以下を確認してください:</p>
            <ul>
                <li>Setup Toolでベイクを実行したか</li>
                <li>表示設定（EnableVR/EnableDesktop等）が有効になっているか</li>
                <li>マテリアルが正しくシェーダー <code>x2much4u/VividAvatarFX</code> を使用しているか</li>
            </ul>

            <h3>Q: パラメータが256を超えてしまう</h3>
            <p><strong>A:</strong> VividAvatarFXのパラメータは同期設定を取らない（networkSynced: false）ため、ExpressionParametersの容量を消費しません。実質的な使用ExParamは0です。ローカル専用パラメータとして動作するため、他のギミックと容量を競合することなく使用できます。</p>

            <h3>Q: プリセットが読み込まれない</h3>
            <p><strong>A:</strong> <code>Assets/x2much4u/VividAvatarFX/Preset/</code> フォルダにJSONファイルが存在するか確認してください。サブフォルダ内でも認識されます。</p>

            <h3>Q: 設定を元に戻したい</h3>
            <p><strong>A:</strong> Setup Toolの「VAFXパラメーターを削除 (Remove Parameters)」ボタンで全パラメータを削除できます。</p>

            <h2 id="license">ライセンス情報</h2>
            <p>このシステムの一部（Camera Analyzer Logic、Vertex Shader structure）は、AoiKamishiro氏が作成したコードを改変したものです。</p>
            <div class="code-block">
Copyright (c) 2020 AoiKamishiro
MIT License
            </div>

        </div>

        <footer>
            <p>&copy; 2024 x2much4u - VividAvatarFX</p>
            <p>VRChat Avatar Effect System</p>
        </footer>
    </div>
</body>
</html>
